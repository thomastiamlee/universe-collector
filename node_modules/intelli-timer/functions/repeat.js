
var repeat = function(interval, duration, task, callback){
    timerIDArr = [];

    var newTask = function(){
        var timerID = setTimeout(newTask, interval);
        timerIDArr.push(timerID);
        // console.log(timerIDArr[0]._called);
        task();
    };

    var stopAllTask = function(){
        for(var i=timerIDArr.length-1 ; i>=0 ; i++){
            var ID = timerIDArr[i];
            if(ID && ID._called == false){
                clearTimeout(ID);
            } else {
                break;
            }
        }
        if(callback && typeof callback === 'function'){
            callback();
        }
    };

    newTask();
    setTimeout(stopAllTask, duration);
};

/*
repeat(100, 900, function(){
    console.log('Hello World');
}, function(){
    console.log('finish');
});
*/


module.exports = repeat;

